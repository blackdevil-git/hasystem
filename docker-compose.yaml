version: "3.7"

services:

  traefik:

    image: "traefik:2.0"

    command:

      - "--providers.docker=true"

      - "--providers.docker.exposedbydefault=false"

      - "--entrypoints.web.address=:80"

    ports:

      - "80:80"

    volumes:

      - "/var/run/docker.sock:/var/run/docker.sock:ro"

  portainer:

    image: portainer/portainer

    restart: always

    volumes:

      - /var/run/docker.sock:/var/run/docker.sock

      - portainer_data:/data

    labels:

      - "traefik.enable=true"

      - "traefik.http.routers.portainer.rule=Host(`dev.portainer`)"

      - "traefik.http.routers.portainer.entrypoints=web"

      # Uncomment this label if your Traefik instance is using a specific Docker network and replace the network name 

      # This is not necessary if you set your default network in Traefik config/parameters

      # - "traefik.docker.network=your-traefik-network-name"
  

  node-red:

    image: nodered/node-red:latest

    container_name: "NodeRed"

    restart: always

    user: "root:root"

    ports:

      - "1880:1880"

    networks:

      - home-system-net

    volumes:

      - home-system-data:/data

    environment:

      - TZ=America/Sao_Paulo
      #- PGID=1000
      #- PUID=1000

  hass:

    image: homeassistant/raspberrypi3-homeassistant:stable

    container_name: "HomeAssistant"

    restart: always

    network_mode: host

    ports:

      - "8123:8123"

    volumes:

      - home-system-data:/config

    environment:

      - TZ=America/Sao_Paulo

  mqtt:

    image: eclipse-mosquitto:latest

    container_name: "mqtt"

    restart: always

    network_mode: host

    ports:

      - 1883:1883

      - 9001:9001

    volumes:

      - home-system-data:/mosquitto/data

      #- home-system-data:/mosquitto/config

      - home-system-data:/mosquitto/log

    environment:

      - TZ=America/Sao_Paulo
  
volumes:

  home-system-data:

  portainer_data:

networks:

  home-system-net:

  proxy:
